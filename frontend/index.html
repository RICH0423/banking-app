<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Banking App</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="../src/main/webapp/css/style.css">
</head>
<body>
<div id="app" class="container">
    <div v-if="!account" class="form-container">
        <h2>Login</h2>
        <div v-if="error" class="error">{{ error }}</div>
        <form @submit.prevent="login">
            <div class="form-group">
                <label>Email</label>
                <input v-model="loginForm.email" type="email" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input v-model="loginForm.password" type="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
        </form>
    </div>

    <div v-else>
        <header>
            <h1>Banking Dashboard</h1>
            <div class="user-info">Welcome, {{ account.customerName }}</div>
        </header>

        <div class="account-info">
            <h2>Account Information</h2>
            <p><strong>Account Number:</strong> {{ account.accountNumber }}</p>
            <p><strong>Current Balance:</strong> {{ account.balance.toFixed(2) }}</p>
        </div>

        <div class="form-container">
            <h2>New Transaction</h2>
            <form @submit.prevent="createTransaction">
                <div class="form-group">
                    <label>Type</label>
                    <select v-model="txForm.transactionType">
                        <option value="DEPOSIT">Deposit</option>
                        <option value="WITHDRAWAL">Withdrawal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" v-model.number="txForm.amount" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input v-model="txForm.description">
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>

        <div class="transaction-history">
            <h2>Recent Transactions</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="t in transactions" :key="t.transactionId">
                        <td>{{ t.transactionDate }}</td>
                        <td>{{ t.transactionType }}</td>
                        <td>{{ t.amount.toFixed(2) }}</td>
                        <td>{{ t.description }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            loginForm: { email: '', password: '' },
            txForm: { transactionType: 'DEPOSIT', amount: 0, description: '' },
            account: null,
            transactions: [],
            error: ''
        };
    },
    methods: {
        async login() {
            this.error = '';
            const res = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(this.loginForm)
            });
            if (res.ok) {
                this.account = await res.json();
                this.loadTransactions();
            } else {
                this.error = 'Login failed';
            }
        },
        async loadTransactions() {
            const res = await fetch(`/api/account/${this.account.accountId}/transactions`);
            if (res.ok) this.transactions = await res.json();
        },
        async createTransaction() {
            await fetch(`/api/account/${this.account.accountId}/transaction`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(this.txForm)
            });
            const accRes = await fetch(`/api/account/${this.account.accountId}`);
            if (accRes.ok) this.account = await accRes.json();
            this.loadTransactions();
            this.txForm = { transactionType: 'DEPOSIT', amount: 0, description: '' };
        }
    }
}).mount('#app');
</script>
</body>
</html>
